<!DOCTYPE html>
<html>
<head>
	<title>testing</title>

	<meta name="viewport" content="width=device-width" />
    <title>DiBS Web API</title>
    <script src="https://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="moment.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- <link rel="stylesheet" type="text/css" href="dibs_1.css"></link> -->
 
</head>
<body>
				<div class = "col-sm-4">
					<h2 class="title"></h2>
						<h3 id="room"></h3>	
							<div class = "table-responsive">
	    						<table class="table">
	    					</table>
						</div>
					</div>
					

	 <script type="text/javascript">
	 	
// Setting Variables
var currentDate = moment().format('MMMM DD, YYYY HH:mm');
var titleDate = moment().format('MMMM DD, YYYY');
var roomID = 48;
var roomNumber = roomID - 47;
var date = new Date().toISOString().slice(0,10);
console.log(currentDate);
var day = moment().day();
var firstHour = '';


// Populating the html with info about date & room #
$(".title").append("Available room reservations for: " + titleDate);
$("#room").append('Library room number: ' + roomNumber);

// API call
var apiQuery = "https://chapelhill.evanced.info/dibsAPI/reservations/" + date + "/" + roomID;

// Ajax call to be made once document is loaded
$(document).ready(function checkTimes() {
$.ajax({
	url: apiQuery,
	method: "GET"
}).done(function(response) {
	
	// Stores times that have already been booked
	var rawBookedTimes = [];
	var cookedBookTimes = [];
	var roomLinks = [];

	// loop for getting the booked times out of the json object
	for (var i = 0; i < response.length; i++) {
		rawBookedTimes.push(response[i]);
	};

	console.log(rawBookedTimes);
	console.log(cookedBookTimes);
	console.log(roomLinks);

	// further isolating the time data. Planning to use this to make the comparison of booked times vs open times
	for (var j = 0; j < rawBookedTimes.length; j++) {
					
		var bookedStart = rawBookedTimes[j].StartTime;
		var bookedEnd = rawBookedTimes[j].EndTime;
		var splitBookStart = bookedStart.split("T");
		var splitBookEnd = bookedEnd.split("T");	
			cookedBookTimes.push(splitBookStart[1] + " - " + splitBookEnd[1]);
	};

// Depending on the day, sets the hours the library is open.  
// Loops through, creating a boolean value to help with comarison function 
function openHours() {
	var open = '';
	var close = '';

	if (day === 6 || day === 7) {
		var open = "10:00:00";
		var close = "18:00:00";
	}
	if (day === 5) {
		var open = "9:00:00";
		var close = "18:00:00";
	} else {
		var open = "9:00:00";
		var close = "20:00:00";
	};
	
	var openHours = {
		
		startTime: open,
		endTime: close,
		slots: []
		
		}
		console.log(openHours.slots);
		var open = parseFloat(openHours.startTime.split(':')[0], 10);
		var close = parseFloat(openHours.endTime.split(':')[0], 10);

		while (open <= close) {
		var currentSlot;
		if (Math.floor(open) === open) {
			currentSlot = "" + open + ":00";
		} else {
			var timeSliced = ("" + open).split('.')[0]
			currentSlot = timeSliced + ":30"
		};
		openHours.slots.push({
			time: currentSlot,
			available: true
		});
		open += 0.5
	};
};

openHours();		
			
			
			// Saving this for later, I need some pieces of it.
			// for (var i = openHours()[0]; i < openHours()[1]; i += .5) {
			// 		var list = "<li>";
			// 		var roomHour = moment().hour(i).minute(00).second(00).format('HH:mm:ss');
			// 		var roomData = "data-name" + "=" + roomHour;
			// 		var link = "<a href=http://chapelhill.evanced.info/dibs/?room=" + roomID + ">";
			// 		roomLinks.push(list + roomData + link);
					

			// 			for (var j = 1; j < roomLinks.length; j += 2) {

			// 			}
			// 	};

		

	});
});
		


			





	 </script>

</body>
</html>